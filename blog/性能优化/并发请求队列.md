由于浏览器最大并发数为 6，如果现在需要马上请求 100 个接口，100 个请求同时发出，就会有 94 个请求处于 pending，浏览器的状态就是等待。

所以优化为：将 100 个拆分成 6 个一组，每一组请求完成进行下一组。

```ts
export const requestLongListTask = <T, R>(
  list: T[],
  req: (item: T) => Promise<R>,
  filter?: (item: T) => boolean,
  max = 6
) => {
  let task: Promise<R>[] = []
  let queue = Promise.all(task)
  const pustTask = (temp: Promise<R>[]) => {
    queue = queue.then(() => Promise.all(temp))
  }

  for (const item of list) {
    if (filter && !filter(item)) {
      continue
    }
    task.push(req(item))
    if (task.length === max) {
      pustTask(task)
      task = []
    }
  }
  if (task.length) {
    pustTask(task)
  }

  return queue
}
```

调用示例：

```ts
requestLongListTask(
  collect(blogTree),
  item => requestContent(item.path + '.md'),
  item => !item.children
)
```
